name: "Validar Conformidade Embrapa I/O"
description: "Validação completa de conformidade com a plataforma Embrapa I/O"
version: "1.0"
category: "validate"
priority: 1

input:
  project_path:
    type: "path"
    description: "Caminho do projeto a ser validado"
    required: true
  severity_levels:
    type: "array"
    description: "Níveis de severidade a validar"
    default: ["CRITICAL", "HIGH", "MEDIUM", "LOW"]
    required: false
  auto_fix:
    type: "boolean"
    description: "Aplicar correções automáticas quando possível"
    default: false
    required: false

output:
  validation_report:
    type: "json"
    path: "{{output_folder}}/validation-report-{{timestamp}}.json"
  compliance_score:
    type: "string"
    values: ["HIGH", "MEDIUM", "LOW"]
  summary_markdown:
    type: "markdown"
    path: "{{output_folder}}/compliance-summary-{{timestamp}}.md"

tasks:
  - id: "detect_project_type"
    description: "Detectar tipo de projeto (NEW/EXISTING/ALREADY_COMPLIANT)"
    instruction: "instructions/detect-project-type.md"

  - id: "validate_docker_compose"
    description: "Validar docker-compose.yaml"
    instruction: "instructions/validate-docker-compose.md"
    condition: "project_type != 'NEW'"

  - id: "validate_env_files"
    description: "Validar arquivos .env"
    instruction: "instructions/validate-env-files.md"
    condition: "project_type != 'NEW'"

  - id: "validate_settings_json"
    description: "Validar .embrapa/settings.json"
    instruction: "instructions/validate-settings.md"
    condition: "project_type != 'NEW'"

  - id: "validate_integrations"
    description: "Validar integrações (Sentry, Matomo)"
    instruction: "instructions/validate-integrations.md"
    condition: "project_type != 'NEW'"

  - id: "calculate_score"
    description: "Calcular compliance score"
    instruction: "instructions/calculate-score.md"

  - id: "generate_report"
    description: "Gerar relatório de conformidade"
    instruction: "instructions/generate-report.md"

  - id: "suggest_fixes"
    description: "Sugerir próximos passos e correções"
    instruction: "instructions/suggest-fixes.md"

  - id: "apply_auto_fixes"
    description: "Aplicar correções automáticas"
    instruction: "instructions/apply-auto-fixes.md"
    condition: "auto_fix == true"

knowledge:
  - "../../../knowledge/embrapa-io-fundamentals.md"
  - "../../../knowledge/embrapa-io-validation.md"
  - "../../../knowledge/embrapa-io-workflows.md"

dependencies:
  - task: "../../core/tasks/read-file.xml"
  - task: "../../core/tasks/parse-yaml.xml"
  - task: "../../core/tasks/parse-json.xml"
